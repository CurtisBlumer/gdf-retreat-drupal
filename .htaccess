# Modify environment variables sent to PHP.
<IfModule mod_env.c>
  # Set the timezone to Central Time.
  SetEnv TZ America/Chicago
</IfModule>

# Various mod_rewrite rules.
<IfModule mod_rewrite.c>
  RewriteEngine on

  RewriteCond %{HTTPS} !on
  RewriteCond %{HTTP_HOST} .
  RewriteCond %{HTTP_HOST} !^www\. [NC]
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

  # Redirect to https:// if we were accessed via http://.
  #RewriteCond %{HTTPS} !=on
  #RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

  RewriteCond %{HTTP_HOST} ^www\.(.+)\/(?:web\/?)(\/.+)?$ [NC]
  RewriteRule ^ https://%1%2 [R=301,L]

  # Redirect all users to access the site WITHOUT the 'www.' prefix.
  RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
  RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

  # Proxy requests to web/ without revealing we're located in a subdirectory.
  RewriteRule ^$ web/$1 [L]
  #RewriteCond %{REQUEST_URI} !^/web/
  RewriteRule ^(.*)$ web/$1 [L]
</IfModule>
